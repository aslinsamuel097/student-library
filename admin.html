<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theolib Admin | Secure Access</title>
    <style>
        :root { --bg: #0b1120; --card: #1e293b; --primary: #3b82f6; --text: #f8fafc; --danger: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .hidden { display: none; }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        button { background: var(--primary); font-weight: bold; cursor: pointer; border: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .id-item { background: #334155; padding: 10px; margin: 5px 0; border-radius: 6px; cursor: pointer; text-align: center; border: 1px solid transparent; }
        .id-item:hover { border-color: var(--primary); background: #1e293b; }
        .details-box { padding: 15px; background: #0f172a; border-radius: 8px; border: 1px solid var(--primary); min-height: 150px; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginSection" class="card" style="max-width: 400px; margin: 100px auto;">
        <h2 style="text-align: center;">Admin Login</h2>
        <input type="password" id="adminPass" placeholder="Enter Admin Password">
        <button onclick="checkLogin()">Access Panel</button>
        <p id="loginError" style="color: var(--danger); text-align: center;"></p>
    </div>

    <div id="adminContent" class="hidden">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1 style="color: var(--primary);">Master Control</h1>
            <button onclick="location.reload()" style="width: auto; padding: 5px 15px; background: #334155;">Logout</button>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Member Directory</h3>
                <label>Select Department:</label>
                <select id="deptSelect" onchange="fetchIDs()">
                    <option value="">-- Select --</option>
                    <option value="Theology">Theology</option>
                    <option value="Arts">Arts</option>
                    <option value="Science">Science</option>
                </select>
                <div id="idList" style="margin-top: 15px; max-height: 300px; overflow-y: auto;">
                    </div>
            </div>

            <div class="card">
                <h3>Profile Information</h3>
                <div id="detailsView" class="details-box">
                    Select a College ID to view member data.
                </div>
            </div>
        </div>

        <div class="card">
            <h3>Book Inventory</h3>
            <input type="text" id="bookSearch" placeholder="Search books..." onkeyup="searchBooks()">
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                <thead>
                    <tr style="text-align: left; color: var(--primary);">
                        <th>Title</th><th>Author</th><th>Action</th>
                    </tr>
                </thead>
                <tbody id="bookTable"></tbody>
            </table>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, where, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBBZ5Yvd7XH4lymNq2vIp-cwxPba55upWg",
        authDomain: "student-library-4a4e7.firebaseapp.com",
        projectId: "student-library-4a4e7",
        storageBucket: "student-library-4a4e7.firebasestorage.app",
        messagingSenderId: "827419448917",
        appId: "1:827419448917:web:4b0d1084e6f1fe1b2566dc"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // LOGIN LOGIC
    window.checkLogin = function() {
        const pass = document.getElementById('adminPass').value;
        if(pass === "admin123") { // SET YOUR PASSWORD HERE
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('adminContent').classList.remove('hidden');
            loadBooks();
        } else {
            document.getElementById('loginError').innerText = "Incorrect Password";
        }
    };

    // FETCH COLLEGE IDs BASED ON DEPT
    window.fetchIDs = async function() {
        const dept = document.getElementById('deptSelect').value;
        const list = document.getElementById('idList');
        list.innerHTML = "Loading IDs...";
        
        const q = query(collection(db, "members"), where("department", "==", dept));
        const snap = await getDocs(q);
        list.innerHTML = "";

        snap.forEach(d => {
            const m = d.data();
            const item = document.createElement('div');
            item.className = 'id-item';
            item.innerText = m.collegeId; // Shows the ID as requested
            item.onclick = () => showMember(m);
            list.appendChild(item);
        });
    };

    // SHOW MEMBER DETAILS
    window.showMember = function(m) {
        document.getElementById('detailsView').innerHTML = `
            <h3 style="color: var(--primary); margin-top:0;">${m.name}</h3>
            <p><strong>ID:</strong> ${m.collegeId}</p>
            <p><strong>Dept:</strong> ${m.department}</p>
            <p><strong>Status:</strong> ${m.isApproved ? "Approved" : "Pending"}</p>
            <button class="btn-danger" style="width: auto; padding: 5px 10px;">Remove Member</button>
        `;
    };

    // INVENTORY LOGIC
    async function loadBooks() {
        const snap = await getDocs(collection(db, "books"));
        const body = document.getElementById('bookTable');
        body.innerHTML = "";
        snap.forEach(d => {
            const b = d.data();
            body.innerHTML += `<tr><td>${b.title}</td><td>${b.author}</td>
            <td><button style="background:var(--danger); padding:2px 8px;" onclick="deleteBook('${d.id}')">Delete</button></td></tr>`;
        });
    }

    window.searchBooks = function() {
        const val = document.getElementById('bookSearch').value.toLowerCase();
        const rows = document.querySelectorAll('#bookTable tr');
        rows.forEach(r => r.style.display = r.innerText.toLowerCase().includes(val) ? "" : "none");
    };

    window.deleteBook = async (id) => {
        if(confirm("Delete book?")) { await deleteDoc(doc(db, "books", id)); loadBooks(); }
    };

</script>
</body>
</html>

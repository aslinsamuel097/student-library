<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Admin - Category Manager</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --blue: #3b82f6; --bg: #f8fafc; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); padding: 20px; }
        .card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 25px; }
        table { width: 100%; border-collapse: collapse; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 13px; }
        select, input { padding: 8px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px; width: 100%; }
        .btn { padding: 8px 12px; border-radius: 8px; border: none; font-size: 11px; cursor: pointer; font-weight: 600; margin: 2px; }
        .btn-add { background: var(--blue); color: white; }
    </style>
</head>
<body>

<div class="card">
    <h2>ðŸ“‚ Global Content Manager</h2>
    <p>Assign books to one of the 6 core categories below.</p>
    
    <div style="background: #f1f5f9; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
        <h4>Add New Book to Category</h4>
        <input type="text" id="new-book-id" placeholder="Book ID (e.g. theology_vol1)">
        <input type="text" id="new-book-title" placeholder="Full Book Title">
        <select id="new-book-cat">
            <option value="Systematic Theology">Systematic Theology</option>
            <option value="CHURCH History">CHURCH History</option>
            <option value="Mission">Mission</option>
            <option value="Acts of Apostles">Acts of Apostles</option>
            <option value="Synoptic Gospel">Synoptic Gospel</option>
            <option value="Introduction to BIBLE">Introduction to BIBLE</option>
        </select>
        <button class="btn btn-add" onclick="addNewBook()">Save to Library</button>
    </div>

    <table id="book-manager-table">
        <thead><tr style="text-align:left; font-size:11px; color:#94a3b8;"><th>BOOK</th><th>CATEGORY</th><th>PROMOTIONS</th></tr></thead>
        <tbody id="admin-book-list"></tbody>
    </table>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyBBZ5Yvd7XH4lymNq2vIp-cwxPba55upWg",
      authDomain: "student-library-4a4e7.firebaseapp.com",
      projectId: "student-library-4a4e7",
      storageBucket: "student-library-4a4e7.firebasestorage.app",
      messagingSenderId: "827419448917",
      appId: "1:827419448917:web:4b0d1084e6f1fe1b2566dc"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function addNewBook() {
        const id = document.getElementById('new-book-id').value.trim();
        const title = document.getElementById('new-book-title').value.trim();
        const cat = document.getElementById('new-book-cat').value;
        
        if(!id || !title) return alert("Fill all fields");

        await db.collection("library_settings").doc(id).set({
            title: title,
            category: cat,
            recent: true, // Automatically mark as recent
            updatedAt: new Date().toISOString()
        }, { merge: true });

        alert("Book Added to " + cat);
        location.reload();
    }

    // Load list for management
    async function loadManager() {
        const snap = await db.collection("library_settings").get();
        const list = document.getElementById('admin-book-list');
        snap.forEach(doc => {
            const b = doc.data();
            list.innerHTML += `<tr>
                <td><b>${b.title}</b></td>
                <td><span style="color:blue">${b.category || 'Uncategorized'}</span></td>
                <td>
                    <button class="btn btn-add" onclick="markAuto('${doc.id}', 'recent', 5)">+ Recent</button>
                    <button class="btn btn-add" onclick="markAuto('${doc.id}', 'trending', 10)">+ Trending</button>
                </td>
            </tr>`;
        });
    }
    loadManager();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheoLib Admin - Master Control</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --blue: #3b82f6; --orange: #f97316; --green: #10b981; --purple: #a855f7; --bg: #0b1120; --card-bg: #1e293b; --text-main: #f8fafc; --text-sub: #94a3b8; --border: #334155; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--text-main); }
        #auth-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 5000; display: flex; align-items: center; justify-content: center; }
        .login-card { background: var(--card-bg); padding: 30px; border-radius: 24px; width: 100%; max-width: 350px; text-align: center; border: 1px solid var(--border); }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 25px; overflow-x: auto; }
        .tab-btn { padding: 10px 20px; border-radius: 12px; border: none; cursor: pointer; background: var(--card-bg); color: var(--text-sub); border: 1px solid var(--border); }
        .tab-btn.active { background: var(--blue); color: white; }
        .glass-card { background: var(--card-bg); border-radius: 20px; padding: 25px; border: 1px solid var(--border); margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        td, th { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); }
        .btn-sm { padding: 8px 15px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; font-size: 11px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="auth-overlay">
        <div class="login-card">
            <h2 style="color:var(--blue)">Admin Login</h2>
            <input type="text" id="admin-coll-id" style="width:100%; padding:12px; margin-bottom:15px; border-radius:8px;" placeholder="College ID">
            <input type="password" id="admin-pass" style="width:100%; padding:12px; margin-bottom:15px; border-radius:8px;" placeholder="Password">
            <button class="btn-sm" style="background:var(--blue); color:white; width:100%; padding:15px;" onclick="handleAdminLogin()">Login</button>
        </div>
    </div>

    <div id="master-panel" class="hidden">
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('inv')">Inventory</button>
            <button class="tab-btn" onclick="switchTab('nom')">Faculty Nominations</button>
            <button class="tab-btn" onclick="switchTab('mem')">Monitoring</button>
            <button class="tab-btn" onclick="location.reload()">Logout</button>
        </div>

        <div id="inv-section" class="glass-card">
            <table><thead><tr><th>Book</th><th>Access</th><th>Mission</th></tr></thead><tbody id="inventory-list"></tbody></table>
        </div>

        <div id="nom-section" class="hidden glass-card">
            <h2>ðŸ“¥ Pending Nominations</h2>
            <div id="nomination-list"></div>
        </div>

        <div id="mem-section" class="hidden glass-card">
            <h2>ðŸ‘¥ Member Monitoring</h2>
            <select id="mon-coll" onchange="loadCollegeStudents(this.value)" style="padding:10px; margin-bottom:20px;"><option value="">Select College</option><option value="IMC26">IMC26</option></select>
            <div id="user-folders-list"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBBZ5Yvd7XH4lymNq2vIp-cwxPba55upWg", authDomain: "theolib.in", projectId: "student-library-4a4e7", storageBucket: "student-library-4a4e7.firebasestorage.app", messagingSenderId: "827419448917", appId: "1:827419448917:web:4b0d1084e6f1fe1b2566dc" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const adminAccounts = { "aslin": "Phlagon@28", "IMC26": "IMC26@theo" };

        function handleAdminLogin() {
            const cid = document.getElementById('admin-coll-id').value.trim();
            const pass = document.getElementById('admin-pass').value.trim();
            if (adminAccounts[cid] === pass) {
                document.getElementById('auth-overlay').classList.add('hidden');
                document.getElementById('master-panel').classList.remove('hidden');
                initAdmin();
            }
        }

        function initAdmin() {
            db.collection("library_settings").onSnapshot(snap => {
                const list = document.getElementById('inventory-list'); list.innerHTML = "";
                snap.forEach(doc => {
                    const b = doc.data();
                    list.innerHTML += `<tr><td>${b.title}</td><td>${b.allowedColleges}</td><td><button onclick="db.collection('library_settings').doc('${doc.id}').update({mission:${!b.mission}})">${b.mission?'On':'Off'}</button></td></tr>`;
                });
            });

            db.collection("faculty_nominations").where("status","==","pending").onSnapshot(snap => {
                const list = document.getElementById('nomination-list'); list.innerHTML = "";
                snap.forEach(doc => {
                    const n = doc.data();
                    list.innerHTML += `<div><b>${n.bookTitle}</b> (From: ${n.facultyName}) <button onclick="approveNom('${doc.id}','${n.bookId}','${n.collegeId}','${n.facultyName}')">Approve</button></div>`;
                });
            });
        }

        async function approveNom(docId, bookId, collegeId, facultyName) {
            await db.collection("library_settings").doc(bookId).set({ recommendations: { [collegeId]: facultyName } }, { merge: true });
            await db.collection("faculty_nominations").doc(docId).delete();
            alert("Live!");
        }

        function switchTab(t) { document.querySelectorAll('.glass-card').forEach(s => s.classList.add('hidden')); document.getElementById(t + '-section').classList.remove('hidden'); }
    </script>
</body>
</html>
